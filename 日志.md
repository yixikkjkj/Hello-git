
# add20210104

## python utcnow 和 now

```
>>> from datetime import datetime
>>> now=datetime.now()
>>> utc=datetime.utcnow()
>>> now
datetime.datetime(2021, 1, 7, 14, 40, 0, 915077)
>>> utc
datetime.datetime(2021, 1, 7, 6, 40, 9, 48427)
>>> now.tzinfo
>>> utc.tzinfo
>>> import time
>>> time.localtime(now.timestamp())
time.struct_time(tm_year=2021, tm_mon=1, tm_mday=7, tm_hour=14, tm_min=40, tm_sec=0, tm_wday=3, tm_yday=7, tm_isdst=0)
>>> time.localtime(utc.timestamp())
time.struct_time(tm_year=2021, tm_mon=1, tm_mday=7, tm_hour=6, tm_min=40, tm_sec=9, tm_wday=3, tm_yday=7, tm_isdst=0)
```

utcnow会根据本地时区做处理，得到的时间对象时区为None，认为是utc时区
now得到的时间对象时区为None，直接认为是utc时区
timestamp方法不会根据时间对象的时区做处理，也没有获取本地时区

## account.actions 过大的问题

### 内容归类

归类思路：
按照虎虎、拼多多功能归类，理由是很多功能是虎虎才有的，比如托管、更新手机号、获取商品热词等，可以更加细分虎虎、拼多多、虎虎staff等部分
但是修改计划类型同样是操作计划的一部分，这样会造成理解困难吗
查询计划时会尝试去同步拼多多数据，这算是虎虎功能还是拼多多功能呢

按照计划、单元、关键词、创意、虎虎账户等进行功能区分，区分地更为细致，可以在更长的时间内堆叠业务避免
但是，很多时候业务会让从不同的功能中获取数据，这就冗杂耦合了，或许我们可以在base层面考虑这个

### EBNF范式

魔兽宏范式规范

```
command = '/' , verb , space , object , { ';' , object } ;
verb = ? the given verbs ? ;
space = ? space word ? ;
object = { condition_list } , space , params ;
params = ? skills, items, equips, toys ? ;
condition_list = '[' , condition { ',' , condition } , ']' ;
condition = [ 'no' ] option [ ':' , arg { '/' arg } ] ;
option = ? the given options ? ;
arg = ? arg that used for option ? ;
```

武僧宏

```
1jx
#showtooltips
/cast [button:4, target=mouseover] 碎玉闪电;猛虎掌
/stopcasting [button:4]
/targetlasttarget [button:4]

2jx
#showtooltips
/cast [button:4] 幻灭踢;神鹤引项踢

3jx
#showtooltips
/cast [button:4] 火焰之息;醉酿投

5jx
#showtooltips
/cast [button:4] 魂体双分;魂体双分：转移

qjx
#showtooltips
/target [button:4] 玄牛雕像
/cast 嚎镇八方
/targetlasttarget [button:4]

ejx
#showtooltip 玄牛雕像
/cast [target=cursor,nobutton:4] 玄牛雕像;null
/stopmacro [button:4]
/click TotemFrameTotem1 RightButton

alt+1jx
#showtooltips
/cast [button:4,target=mouseover,noharm][button:4,target=player] 活血术;[target=mouseover,noharm][target=player] 清创生血

alt+2jx
#showtooltips
/cast [target=cursor] 分筋错骨

fjx
#showtooltips
/cast [button:4,target=mouseover] 对冲;真气突

gjx
#showtooltips
/cast [button:4] 切喉手;猛虎摆尾

f1jx
#showtooltips
/cast [button:4] 玄牛下凡;金创药

f3jx
#showtooltips
/cast [button:4] 禅悟冥想;壮胆酒
```

## 排名监控的问题

### 排名监控需要

1. 排名监控最终监控的是关键词的排名
2. 用户选择监控关键词排名

### 排名监控开发

后端接口

```json
// 接口 获取商品对应的关键词 /keyword/by_goods
type req = {
    goods_id: number,
    start_t: string,  // YYYY-MM-DD
    end_t: string,  // YYYY-MM-DD
}

type res = {
    keyword_list: [
        {
            word: string,  // 关键词
            data_list: [  // 按照rank_list的最后一个排序
                {
                    plan: {...Plan},
                    unit: {...Unit},
                    keyword: {...keyword},
                },
                ...
            ],
        },
        ...
    ],
}

// 接口 获取关键词的报告列表 /keyword/report
type req = {
    keyword_id: number,
    start_t: string,
    end_t: string,
}

type res = {
    report_list: [
        {
            report_date: string,
            rank_avg: string,
        },
        ...
    ]
}
```

## 关键词历史排名查询

### 目前的情况

目前支持查看的是今天的排名数据，这个数据是通过 report_entity_report_query 接口拿到的，在 external_fields_values 中获取

每天的关键词报告是通过 report_entity_report_query 接口拿到的，接口相同，时间取得是昨天一整天，但未保存排名数据

### 可以做的事情

1. 每天的关键词报告中，保存排名数据
   1. 排名数据是 str，增加排名数据
2. 旧数据修正
   1. 可以直接置为 --
3. 前端数据展示时
   1. 针对今日和历史排名，可以整合到一个字段上进行展示
